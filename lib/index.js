"use strict";

Object.defineProperty(exports, "__esModule", {
	value: true
});
exports.insertAction = undefined;

var _ramda = require("ramda");

var R = _interopRequireWildcard(_ramda);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }

var chain = [{
	state: {},
	lookup: {}
}];

var insertAction = exports.insertAction = function insertAction(action) {
	var insertIndex = R.findIndex(R.pipe(R.path(["action", "meta", "time"]), R.lt(action.meta.time)), chain);

	chain = R.insert(insertIndex, {
		action: action
	}, chain);

	chain = R.scan(function (_ref, _ref2) {
		var state = _ref.state,
		    lookup = _ref.lookup;
		var action = _ref2.action;

		return Object.assign({}, R.reduce(function (_ref3, _ref4) {
			var state = _ref3.state,
			    lookup = _ref3.lookup;
			var type = _ref4.type,
			    path = _ref4.path,
			    value = _ref4.value;
			return R.evolve({
				state: type === "assoc" ? R.assocPath([action.meta.obj].concat(_toConsumableArray(path)), value) : R.dissocPath([action.meta.obj].concat(_toConsumableArray(path))),

				lookup: type === "assoc" ? R.assocPath([].concat(_toConsumableArray(path), [action.meta.obj]), value) : R.dissocPath([].concat(_toConsumableArray(path), [action.meta.obj]))
			})({ state: state, lookup: lookup });
		}, { state: state, lookup: lookup }, action.mutations), {
			action: action
		});
	}, R.head(chain), R.tail(chain));
};

var earlyAction = {
	meta: {
		time: 1415677760,
		action: "ba3ab7a5-e33f-4537-85a7-66d3fff04527",
		obj: "69581654-e60c-46cd-9f47-f29be6d81917"
	},
	mutations: [{
		type: "assoc",
		path: ["description"],
		value: "this is one description"
	}, {
		type: "assoc",
		path: ["tags", "test"],
		value: true
	}, {
		type: "assoc",
		path: ["tags", "personal"],
		value: true
	}]
};

var testAction = {
	meta: {
		time: 1515677760,
		action: "33a3bd64-0edd-4c45-af05-99987fcb1c02",
		obj: "ff734a42-ebf9-4f57-8bf9-549b8db7e7ee"
	},
	mutations: [{
		type: "assoc",
		path: ["description"],
		value: "need to buy more ham"
	}, {
		type: "assoc",
		path: ["tags", "money"],
		value: true
	}, {
		type: "assoc",
		path: ["tags", "personal"],
		value: true
	}]
};

var clearAction = {
	meta: {
		time: 1615677760,
		action: "33a3bd64-0edd-4c45-af05-99987fcb1c02",
		obj: "ff734a42-ebf9-4f57-8bf9-549b8db7e7ee"
	},
	mutations: [{
		type: "dissoc",
		path: ["description"],
		value: "need to buy more ham"
	}, {
		type: "dissoc",
		path: ["tags", "money"],
		value: true
	}]
};

insertAction(testAction);
insertAction(earlyAction);
insertAction(clearAction);

console.log(JSON.stringify(chain, null, 2));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC5qcyJdLCJuYW1lcyI6WyJSIiwiY2hhaW4iLCJzdGF0ZSIsImxvb2t1cCIsImluc2VydEFjdGlvbiIsImFjdGlvbiIsImluc2VydEluZGV4IiwiZmluZEluZGV4IiwicGlwZSIsInBhdGgiLCJsdCIsIm1ldGEiLCJ0aW1lIiwiaW5zZXJ0Iiwic2NhbiIsInJlZHVjZSIsInR5cGUiLCJ2YWx1ZSIsImV2b2x2ZSIsImFzc29jUGF0aCIsIm9iaiIsImRpc3NvY1BhdGgiLCJtdXRhdGlvbnMiLCJoZWFkIiwidGFpbCIsImVhcmx5QWN0aW9uIiwidGVzdEFjdGlvbiIsImNsZWFyQWN0aW9uIiwiY29uc29sZSIsImxvZyIsIkpTT04iLCJzdHJpbmdpZnkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFDQTs7SUFBWUEsQzs7Ozs7O0FBNEJaLElBQUlDLFFBQWtCLENBQ3JCO0FBQ0NDLFFBQU8sRUFEUjtBQUVDQyxTQUFRO0FBRlQsQ0FEcUIsQ0FBdEI7O0FBT08sSUFBTUMsc0NBQWUsU0FBZkEsWUFBZSxDQUFDQyxNQUFELEVBQXVCO0FBQ2xELEtBQU1DLGNBQWNOLEVBQUVPLFNBQUYsQ0FDbkJQLEVBQUVRLElBQUYsQ0FBT1IsRUFBRVMsSUFBRixDQUFPLENBQUMsUUFBRCxFQUFXLE1BQVgsRUFBbUIsTUFBbkIsQ0FBUCxDQUFQLEVBQTJDVCxFQUFFVSxFQUFGLENBQUtMLE9BQU9NLElBQVAsQ0FBWUMsSUFBakIsQ0FBM0MsQ0FEbUIsRUFFbkJYLEtBRm1CLENBQXBCOztBQUtBQSxTQUFRRCxFQUFFYSxNQUFGLENBQ1BQLFdBRE8sRUFFUDtBQUNDRDtBQURELEVBRk8sRUFLUEosS0FMTyxDQUFSOztBQVFBQSxTQUFRRCxFQUFFYyxJQUFGLENBQ1AsdUJBQW1DO0FBQUEsTUFBaENaLEtBQWdDLFFBQWhDQSxLQUFnQztBQUFBLE1BQXpCQyxNQUF5QixRQUF6QkEsTUFBeUI7QUFBQSxNQUFiRSxNQUFhLFNBQWJBLE1BQWE7O0FBQ2xDLDJCQUNJTCxF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RUFBNEIsQ0FBNUIsQ0FBWiIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEBmbG93XG5pbXBvcnQgKiBhcyBSIGZyb20gXCJyYW1kYVwiO1xuXG50eXBlIE11dGF0aW9uID0ge1xuXHR0eXBlOiBcImFzc29jXCIgfCBcImRpc3NvY1wiLFxuXHRwYXRoOiBBcnJheTxzdHJpbmc+LFxuXHR2YWx1ZTogc3RyaW5nIHwgbnVtYmVyIHwgYm9vbGVhbixcbn07XG5cbnR5cGUgSmVjQWN0aW9uID0ge1xuXHRtZXRhOiB7XG5cdFx0dGltZTogbnVtYmVyLFxuXHRcdGFjdGlvbjogc3RyaW5nLFxuXHRcdG9iajogc3RyaW5nLFxuXHR9LFxuXHRtdXRhdGlvbnM6IEFycmF5PE11dGF0aW9uPixcbn07XG5cbnR5cGUgR2VuZXRpY09iamVjdEVsZW1lbnQgPSB7XG5cdFtzdHJpbmddOiBzdHJpbmcgfCBudW1iZXIgfCBib29sZWFuIHwgR2VuZXRpY09iamVjdEVsZW1lbnQsXG59O1xuXG50eXBlIEplY0NoYWluTGluayA9IHtcblx0c3RhdGU6IEdlbmV0aWNPYmplY3RFbGVtZW50LFxuXHRsb29rdXA6IEdlbmV0aWNPYmplY3RFbGVtZW50LFxuXHRhY3Rpb24/OiBKZWNBY3Rpb24sXG59O1xuXG50eXBlIEplY0NoYWluID0gQXJyYXk8SmVjQ2hhaW5MaW5rPjtcbmxldCBjaGFpbjogSmVjQ2hhaW4gPSBbXG5cdHtcblx0XHRzdGF0ZToge30sXG5cdFx0bG9va3VwOiB7fSxcblx0fSxcbl07XG5cbmV4cG9ydCBjb25zdCBpbnNlcnRBY3Rpb24gPSAoYWN0aW9uOiBKZWNBY3Rpb24pID0+IHtcblx0Y29uc3QgaW5zZXJ0SW5kZXggPSBSLmZpbmRJbmRleChcblx0XHRSLnBpcGUoUi5wYXRoKFtcImFjdGlvblwiLCBcIm1ldGFcIiwgXCJ0aW1lXCJdKSwgUi5sdChhY3Rpb24ubWV0YS50aW1lKSksXG5cdFx0Y2hhaW4sXG5cdCk7XG5cblx0Y2hhaW4gPSBSLmluc2VydChcblx0XHRpbnNlcnRJbmRleCxcblx0XHR7XG5cdFx0XHRhY3Rpb24sXG5cdFx0fSxcblx0XHRjaGFpbixcblx0KTtcblxuXHRjaGFpbiA9IFIuc2Nhbihcblx0XHQoeyBzdGF0ZSwgbG9va3VwIH0sIHsgYWN0aW9uIH0pID0+IHtcblx0XHRcdHJldHVybiB7XG5cdFx0XHRcdC4uLlIucmVkdWNlKFxuXHRcdFx0XHRcdCh7IHN0YXRlLCBsb29rdXAgfSwgeyB0eXBlLCBwYXRoLCB2YWx1ZSB9KSA9PlxuXHRcdFx0XHRcdFx0Ui5ldm9sdmUoe1xuXHRcdFx0XHRcdFx0XHRzdGF0ZTpcblx0XHRcdFx0XHRcdFx0XHR0eXBlID09PSBcImFzc29jXCJcblx0XHRcdFx0XHRcdFx0XHRcdD8gUi5hc3NvY1BhdGgoXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0W2FjdGlvbi5tZXRhLm9iaiwgLi4ucGF0aF0sXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0dmFsdWUsXG5cdFx0XHRcdFx0XHRcdFx0XHRcdClcblx0XHRcdFx0XHRcdFx0XHRcdDogUi5kaXNzb2NQYXRoKFthY3Rpb24ubWV0YS5vYmosIC4uLnBhdGhdKSxcblxuXHRcdFx0XHRcdFx0XHRsb29rdXA6XG5cdFx0XHRcdFx0XHRcdFx0dHlwZSA9PT0gXCJhc3NvY1wiXG5cdFx0XHRcdFx0XHRcdFx0XHQ/IFIuYXNzb2NQYXRoKFxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFsuLi5wYXRoLCBhY3Rpb24ubWV0YS5vYmpdLFxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHZhbHVlLFxuXHRcdFx0XHRcdFx0XHRcdFx0XHQpXG5cdFx0XHRcdFx0XHRcdFx0XHQ6IFIuZGlzc29jUGF0aChbLi4ucGF0aCwgYWN0aW9uLm1ldGEub2JqXSksXG5cdFx0XHRcdFx0XHR9KSh7IHN0YXRlLCBsb29rdXAgfSksXG5cblx0XHRcdFx0XHR7IHN0YXRlLCBsb29rdXAgfSxcblx0XHRcdFx0XHRhY3Rpb24ubXV0YXRpb25zLFxuXHRcdFx0XHQpLFxuXHRcdFx0XHRhY3Rpb24sXG5cdFx0XHR9O1xuXHRcdH0sXG5cdFx0Ui5oZWFkKGNoYWluKSxcblx0XHRSLnRhaWwoY2hhaW4pLFxuXHQpO1xufTtcblxuY29uc3QgZWFybHlBY3Rpb246IEplY0FjdGlvbiA9IHtcblx0bWV0YToge1xuXHRcdHRpbWU6IDE0MTU2Nzc3NjAsXG5cdFx0YWN0aW9uOiBcImJhM2FiN2E1LWUzM2YtNDUzNy04NWE3LTY2ZDNmZmYwNDUyN1wiLFxuXHRcdG9iajogXCI2OTU4MTY1NC1lNjBjLTQ2Y2QtOWY0Ny1mMjliZTZkODE5MTdcIixcblx0fSxcblx0bXV0YXRpb25zOiBbXG5cdFx0e1xuXHRcdFx0dHlwZTogXCJhc3NvY1wiLFxuXHRcdFx0cGF0aDogW1wiZGVzY3JpcHRpb25cIl0sXG5cdFx0XHR2YWx1ZTogXCJ0aGlzIGlzIG9uZSBkZXNjcmlwdGlvblwiLFxuXHRcdH0sXG5cdFx0e1xuXHRcdFx0dHlwZTogXCJhc3NvY1wiLFxuXHRcdFx0cGF0aDogW1widGFnc1wiLCBcInRlc3RcIl0sXG5cdFx0XHR2YWx1ZTogdHJ1ZSxcblx0XHR9LFxuXHRcdHtcblx0XHRcdHR5cGU6IFwiYXNzb2NcIixcblx0XHRcdHBhdGg6IFtcInRhZ3NcIiwgXCJwZXJzb25hbFwiXSxcblx0XHRcdHZhbHVlOiB0cnVlLFxuXHRcdH0sXG5cdF0sXG59O1xuXG5jb25zdCB0ZXN0QWN0aW9uOiBKZWNBY3Rpb24gPSB7XG5cdG1ldGE6IHtcblx0XHR0aW1lOiAxNTE1Njc3NzYwLFxuXHRcdGFjdGlvbjogXCIzM2EzYmQ2NC0wZWRkLTRjNDUtYWYwNS05OTk4N2ZjYjFjMDJcIixcblx0XHRvYmo6IFwiZmY3MzRhNDItZWJmOS00ZjU3LThiZjktNTQ5YjhkYjdlN2VlXCIsXG5cdH0sXG5cdG11dGF0aW9uczogW1xuXHRcdHtcblx0XHRcdHR5cGU6IFwiYXNzb2NcIixcblx0XHRcdHBhdGg6IFtcImRlc2NyaXB0aW9uXCJdLFxuXHRcdFx0dmFsdWU6IFwibmVlZCB0byBidXkgbW9yZSBoYW1cIixcblx0XHR9LFxuXHRcdHtcblx0XHRcdHR5cGU6IFwiYXNzb2NcIixcblx0XHRcdHBhdGg6IFtcInRhZ3NcIiwgXCJtb25leVwiXSxcblx0XHRcdHZhbHVlOiB0cnVlLFxuXHRcdH0sXG5cdFx0e1xuXHRcdFx0dHlwZTogXCJhc3NvY1wiLFxuXHRcdFx0cGF0aDogW1widGFnc1wiLCBcInBlcnNvbmFsXCJdLFxuXHRcdFx0dmFsdWU6IHRydWUsXG5cdFx0fSxcblx0XSxcbn07XG5cbmNvbnN0IGNsZWFyQWN0aW9uOiBKZWNBY3Rpb24gPSB7XG5cdG1ldGE6IHtcblx0XHR0aW1lOiAxNjE1Njc3NzYwLFxuXHRcdGFjdGlvbjogXCIzM2EzYmQ2NC0wZWRkLTRjNDUtYWYwNS05OTk4N2ZjYjFjMDJcIixcblx0XHRvYmo6IFwiZmY3MzRhNDItZWJmOS00ZjU3LThiZjktNTQ5YjhkYjdlN2VlXCIsXG5cdH0sXG5cdG11dGF0aW9uczogW1xuXHRcdHtcblx0XHRcdHR5cGU6IFwiZGlzc29jXCIsXG5cdFx0XHRwYXRoOiBbXCJkZXNjcmlwdGlvblwiXSxcblx0XHRcdHZhbHVlOiBcIm5lZWQgdG8gYnV5IG1vcmUgaGFtXCIsXG5cdFx0fSxcblx0XHR7XG5cdFx0XHR0eXBlOiBcImRpc3NvY1wiLFxuXHRcdFx0cGF0aDogW1widGFnc1wiLCBcIm1vbmV5XCJdLFxuXHRcdFx0dmFsdWU6IHRydWUsXG5cdFx0fSxcblx0XSxcbn07XG5cbmluc2VydEFjdGlvbih0ZXN0QWN0aW9uKTtcbmluc2VydEFjdGlvbihlYXJseUFjdGlvbik7XG5pbnNlcnRBY3Rpb24oY2xlYXJBY3Rpb24pO1xuXG5jb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShjaGFpbiwgbnVsbCwgMikpO1xuIl19